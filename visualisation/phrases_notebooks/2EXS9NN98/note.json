{
  "paragraphs": [
    {
      "text": "%dep\n\nz.reset()\nz.load(\"/zeppelin/local-repo/mysql-connector-java-5.1.6.jar\")",
      "user": "anonymous",
      "dateUpdated": "Jan 19, 2020 12:45:51 PM",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false
        },
        "colWidth": 12.0,
        "editorMode": "ace/mode/scala",
        "editorHide": false,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR",
        "msg": [
          {
            "type": "TEXT",
            "data": "Must be used before SparkInterpreter (%spark) initialized\nHint: put this paragraph before any Spark code and restart Zeppelin/Interpreter"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1579163966285_-1822596115",
      "id": "20200111-120346_858972808",
      "dateCreated": "Jan 16, 2020 8:39:26 AM",
      "dateStarted": "Jan 19, 2020 12:45:51 PM",
      "dateFinished": "Jan 19, 2020 12:45:51 PM",
      "status": "ERROR",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\nimport org.apache.spark.sql._\n\ndef printQueryResultsAsTable(dataFrame: DataFrame) : Unit \u003d {\n print(\"%table\\n\" + dataFrame.columns.mkString(\"\\t\") + \u0027\\n\u0027+ dataFrame.map(x \u003d\u003e x.mkString(\"\\t\")).collect().mkString(\"\\n\")) \n}\n\ndef getDataFrame(query: String, columnNames: Seq[String]): DataFrame \u003d {\n    // print(query)\n    val df \u003d sqlContext.read.format(\"jdbc\").option(\"driver\",\"com.mysql.jdbc.Driver\")\n    .option(\"url\",\"jdbc:mysql://maria-gdelt:3306/bd_gdelt\")\n    .option(\"databaseName\", \"bd_gdelt\")\n    .option(\"user\", \"root\")\n    .option(\"password\",\"root\")\n    .option(\"dbtable\", query)\n    .load()\n    .toDF(columnNames: _*)\n    return df\n}\n\nval sqlQuery \u003d \"\"\"(SELECT * FROM (SELECT k.keyword, k.score, a.title,c.name, a.date_event, ROUND(LENGTH(REGEXP_REPLACE(k.keyword,\u0027[^ \\t]\u0027,\u0027\u0027))+1) as \u0027len\u0027 FROM article_keyword k\n         JOIN article a on k.article_id \u003d a.id\n         JOIN country c on a.country_id \u003d c.id) phrases ${0} ) AS phrases_table \"\"\"\n         \nval columnNames \u003d Seq(\"Phrase\", \"Score\", \"Article title\", \"Country\",\"Date\",\"Phrase length\")",
      "user": "anonymous",
      "dateUpdated": "Jan 19, 2020 1:00:44 PM",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false
        },
        "editorMode": "ace/mode/scala"
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "\nimport org.apache.spark.sql._\n\nprintQueryResultsAsTable: (dataFrame: org.apache.spark.sql.DataFrame)Unit\n\ngetDataFrame: (query: String, columnNames: Seq[String])org.apache.spark.sql.DataFrame\n\n\n\n\nsqlQuery: String \u003d\n\"(SELECT * FROM (SELECT k.keyword, k.score, a.title,c.name, a.date_event, ROUND(LENGTH(REGEXP_REPLACE(k.keyword,\u0027[^ \\t]\u0027,\u0027\u0027))+1) as \u0027len\u0027 FROM article_keyword k\n         JOIN article a on k.article_id \u003d a.id\n         JOIN country c on a.country_id \u003d c.id) phrases ${0} ) AS phrases_table \"\n\ncolumnNames: Seq[String] \u003d List(Phrase, Score, Article title, Country, Date, Phrase length)\n"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1579303694253_-1234279669",
      "id": "20200117-232814_1697664171",
      "dateCreated": "Jan 17, 2020 11:28:14 PM",
      "dateStarted": "Jan 19, 2020 12:57:22 PM",
      "dateFinished": "Jan 19, 2020 12:57:23 PM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\nval dateFrom \u003d z.input(\"Date from\");\nval dateTo \u003d z.input(\"Date to\");\nval phraseLenFrom \u003d z.input(\"Phrase length from\");\nval phraseLenTo \u003d z.input(\"Phrase length to\");\nval scoreFrom \u003d z.input(\"Min score\");\nval scoreTo \u003d z.input(\"Max score\");\nval country \u003d z.input(\"Country name\");\nval limit \u003d z.input(\"Limit\",\"100\")\nval sort \u003d z.select(\"Sort by\",Seq((\"\",\"None\"),(\"keyword\",\"Phrase\"),(\"score\",\"Score\"),(\"title\",\"Title\"),(\"name\",\"Country\"),(\"date_event\",\"Date\"),(\"len\",\"Phrase length\")))\nval sortType \u003d z.select(\"Asc/Desc\",Seq((\"\",\"Ascending\"),(\"DESC\",\"Descending\")))\n\nvar conditions \u003d List[String]()\nif(dateFrom !\u003d\"\"){\n    conditions \u003d (\"date_event \u003e\u003d \u0027\"+dateFrom+\"\u0027\") :: conditions\n}\nif(dateTo !\u003d\"\"){\n    conditions \u003d (\"date_event \u003c\u003d \u0027\"+dateTo+\"\u0027\") :: conditions\n}\nif(scoreFrom !\u003d\"\"){\n    conditions \u003d (\"score \u003e\u003d \u0027\"+scoreFrom+\"\u0027\") :: conditions\n}\nif(scoreTo !\u003d\"\"){\n    conditions \u003d (\"score \u003c\u003d \u0027\"+scoreTo+\"\u0027\") :: conditions\n}\nif(phraseLenFrom !\u003d\"\"){\n    conditions \u003d (\"len \u003e\u003d \u0027\"+phraseLenFrom+\"\u0027\") :: conditions\n}\nif(phraseLenTo !\u003d\"\"){\n    conditions \u003d (\"len \u003c\u003d \u0027\"+phraseLenTo+\"\u0027\") :: conditions\n}\nif(country !\u003d\"\"){\n    conditions \u003d (\"name LIKE \u0027%\"+country+\"%\u0027\") :: conditions\n}\n\nval condJoined \u003d (if(conditions.isEmpty) \"\" else \"WHERE \")+ conditions.mkString(\" AND \") + (if(sort !\u003d \"\") (\" ORDER BY \" + sort +\" \"+ sortType) else \"\") + (if(limit!\u003d\"\") (\" LIMIT \"+limit) else \"LIMIT 100\")\n\nval df \u003d getDataFrame(sqlQuery.replace(\"${0}\", condJoined), columnNames)\nprintQueryResultsAsTable(df)\n",
      "user": "anonymous",
      "dateUpdated": "Jan 19, 2020 1:01:42 PM",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {
          "1": {
            "graph": {
              "mode": "table",
              "height": 508.0,
              "optionOpen": true,
              "setting": {
                "stackedAreaChart": {
                  "style": "stack"
                }
              },
              "commonSetting": {},
              "keys": [
                {
                  "name": "Phrase",
                  "index": 0.0,
                  "aggr": "sum"
                }
              ],
              "groups": [],
              "values": [
                {
                  "name": "Score",
                  "index": 1.0,
                  "aggr": "sum"
                }
              ]
            },
            "helium": {}
          }
        },
        "editorSetting": {
          "language": "scala",
          "editOnDblClick": false
        },
        "editorMode": "ace/mode/scala",
        "runOnSelectionChange": false,
        "editorHide": false,
        "tableHide": false
      },
      "settings": {
        "params": {
          "fruit": [],
          "name": "sa",
          "Data od": "",
          "Data do": "",
          "Długość frazy od": "",
          "Długość frazy do": "",
          "Kraj": "",
          "Sortowanie": "score",
          "Typ sortowanie": "",
          "Date to": "2019-12-30",
          "Date from": "2019-12-01",
          "Phrase length from": "2",
          "Phrase length to": "4",
          "Country name": "king",
          "Limit": "50",
          "Min score": "2.2",
          "Max score": "13.36",
          "Sort by": "score",
          "Asc/Desc": "DESC"
        },
        "forms": {
          "Date from": {
            "name": "Date from",
            "displayName": "Date from",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Date to": {
            "name": "Date to",
            "displayName": "Date to",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Phrase length from": {
            "name": "Phrase length from",
            "displayName": "Phrase length from",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Phrase length to": {
            "name": "Phrase length to",
            "displayName": "Phrase length to",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Min score": {
            "name": "Min score",
            "displayName": "Min score",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Max score": {
            "name": "Max score",
            "displayName": "Max score",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Country name": {
            "name": "Country name",
            "displayName": "Country name",
            "type": "input",
            "defaultValue": "",
            "hidden": false
          },
          "Limit": {
            "name": "Limit",
            "displayName": "Limit",
            "type": "input",
            "defaultValue": "100",
            "hidden": false
          },
          "Sort by": {
            "name": "Sort by",
            "displayName": "Sort by",
            "type": "select",
            "defaultValue": "",
            "options": [
              {
                "value": "",
                "displayName": "None"
              },
              {
                "value": "keyword",
                "displayName": "Phrase"
              },
              {
                "value": "score",
                "displayName": "Score"
              },
              {
                "value": "title",
                "displayName": "Title"
              },
              {
                "value": "name",
                "displayName": "Country"
              },
              {
                "value": "date_event",
                "displayName": "Date"
              },
              {
                "value": "len",
                "displayName": "Phrase length"
              }
            ],
            "hidden": false
          },
          "Asc/Desc": {
            "name": "Asc/Desc",
            "displayName": "Asc/Desc",
            "type": "select",
            "defaultValue": "",
            "options": [
              {
                "value": "",
                "displayName": "Ascending"
              },
              {
                "value": "DESC",
                "displayName": "Descending"
              }
            ],
            "hidden": false
          }
        }
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "TEXT",
            "data": "\ndateFrom: Object \u003d 2019-12-01\n\ndateTo: Object \u003d 2019-12-30\n\nphraseLenFrom: Object \u003d 2\n\nphraseLenTo: Object \u003d 4\n\nscoreFrom: Object \u003d 2.2\n\nscoreTo: Object \u003d 13.36\n\ncountry: Object \u003d king\n\nlimit: Object \u003d 50\n\nsort: Object \u003d score\n\nsortType: Object \u003d DESC\n\nconditions: List[String] \u003d List()\n\ncondJoined: String \u003d WHERE name LIKE \u0027%king%\u0027 AND len \u003c\u003d \u00274\u0027 AND len \u003e\u003d \u00272\u0027 AND score \u003c\u003d \u002713.36\u0027 AND score \u003e\u003d \u00272.2\u0027 AND date_event \u003c\u003d \u00272019-12-30\u0027 AND date_event \u003e\u003d \u00272019-12-01\u0027 ORDER BY score DESC LIMIT 50\n(SELECT * FROM (SELECT k.keyword, k.score, a.title,c.name, a.date_event, ROUND(LENGTH(REGEXP_REPLACE(k.keyword,\u0027[^ \\t]\u0027,\u0027\u0027))+1) as \u0027len\u0027 FROM article_keyword k\n         JOIN article a on k.article_id \u003d a.id\n         JOIN country c on a.country_id \u003d c.id) phrases WHERE name LIKE \u0027%king%\u0027 AND len \u003c\u003d \u00274\u0027 AND len \u003e\u003d \u00272\u0027 AND score \u003c\u003d \u002713.36\u0027 AND score \u003e\u003d \u00272.2\u0027 AND date_event \u003c\u003d \u00272019-12-30\u0027 AND date_event \u003e\u003d \u00272019-12-01\u0027 ORDER BY score DESC LIMIT 50 ) AS phrases_table \ndf: org.apache.spark.sql.DataFrame \u003d [Phrase: string, Score: decimal(9,2) ... 4 more fields]\n"
          },
          {
            "type": "TABLE",
            "data": "Phrase\tScore\tArticle title\tCountry\tDate\tPhrase length\nmaj gen soleimani represented\t13.36\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t4\ntop iranian security official\t13.25\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t4\nus-led coalition scaling back\t13.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t4\nsky news understands\t9.73\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nsenior iranian official\t9.50\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nmaj gen soleimani\t9.36\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nweakest scenario carrying\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nlinked shia militias\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nwords drew cries\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nsub-saharan african nations\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nincorrectly implied withdrawal\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nidentified 52 iranian sites\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t4\nincreased troop movements\t9.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\ntop iranian officials\t8.75\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\ngeneral mark milley\t8.71\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nleft 213 people injured\t8.33\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t4\niranian capital tehran\t8.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nmajor general soleimani\t7.57\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\ntask force iraq\t7.27\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\ntop military commander\t6.75\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t3\nsky news\t6.73\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ndonald trump\t5.67\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nali shamkhani\t5.67\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nnews reporter\t5.40\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nqassem soleimani\t4.86\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\niranian general\t4.71\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nmr trump\t4.67\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nisrael faced\t4.33\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\npeople lined\t4.33\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ncoalition forces\t4.33\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nmillion people\t4.33\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nquds unit\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nunprecedented honour\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\namerican soldiers\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\namerican contractor\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ncultural significance\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ntom gillespie\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nmr salami\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nminimum level\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nstate television\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\namerican commander\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nhistoric nightmare\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ncoming days\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\npoorly worded\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ngreater threat\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nseely iii\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nparliament called\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ndaily podcast\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\ngoogle podcasts\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2\nrevolutionary guard\t4.00\tUS - led coalition to  scale back in Baghdad  after Soleimani killing\t\"United Kingdom\"\t2019-12-30\t2"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1579205435806_916076836",
      "id": "20200116-201035_1898938135",
      "dateCreated": "Jan 16, 2020 8:10:35 PM",
      "dateStarted": "Jan 19, 2020 1:01:42 PM",
      "dateFinished": "Jan 19, 2020 1:01:44 PM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark\n",
      "user": "anonymous",
      "dateUpdated": "Jan 19, 2020 12:46:13 PM",
      "config": {},
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1579437973524_451561233",
      "id": "20200119-124613_548952708",
      "dateCreated": "Jan 19, 2020 12:46:13 PM",
      "status": "READY",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "Article keywords",
  "id": "2EXS9NN98",
  "angularObjects": {
    "2EXXBCD7G:shared_process": [],
    "2EXU3GHHD:shared_process": [],
    "2EZDTSEJH:shared_process": [],
    "2EWGU334V:shared_process": [],
    "2EZ8PX3QN:shared_process": [],
    "2EX25V1DK:shared_process": [],
    "2EZG5R422:shared_process": [],
    "2EWFCE2P7:shared_process": [],
    "2EX7UVWJ4:shared_process": [],
    "2EX2U5JCJ:shared_process": [],
    "2F11778TB:shared_process": [],
    "2EZP18Q2R:shared_process": [],
    "2EYZ8GYZW:shared_process": [],
    "2EXVEC2C6:shared_process": [],
    "2EZJBVDNA:shared_process": [],
    "2EXQ8EWWH:shared_process": [],
    "2EWPDFTPV:shared_process": [],
    "2EXF489PF:shared_process": [],
    "2EZCTWKE2:shared_process": []
  },
  "config": {
    "looknfeel": "default",
    "personalizedMode": "false"
  },
  "info": {}
}